<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Horta Hero - Impacto Real na Terra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2D5A27;
            --secondary: #4A7C44;
            --accent: #8BA888;
            --background: #F4F7F2;
            --card-bg: #FFFFFF;
            --text-main: #1A2E19;
            --text-muted: #5C715B;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--background);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 0.3s ease;
        }

        .premium-card {
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.2s ease;
        }

        .impact-gradient {
            background: linear-gradient(135deg, #2D5A27 0%, #4A7C44 100%);
            color: white;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            height: 80px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            z-index: 100;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-muted);
            font-size: 10px;
            font-weight: 600;
            gap: 4px;
            background: none;
            border: none;
            cursor: pointer;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-center-btn {
            width: 56px;
            height: 56px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 8px 20px rgba(45, 90, 39, 0.3);
            margin-top: -40px;
            border: 4px solid var(--background);
            cursor: pointer;
        }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .water-drop {
            position: absolute;
            color: #3b82f6;
            pointer-events: none;
            animation: dropAnim 0.8s ease-out forwards;
            z-index: 50;
        }
        @keyframes dropAnim {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-40px) scale(1.5); opacity: 0; }
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .dark-mode {
            --background: #121811;
            --card-bg: #1C251B;
            --text-main: #E8F0E7;
            --text-muted: #9BB09A;
        }

        .plant-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            white-space: nowrap;
            transition: all 0.2s;
            border: 1px solid rgba(0,0,0,0.05);
            background: var(--card-bg);
            color: var(--text-muted);
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 12px rgba(45, 90, 39, 0.2);
        }

        .biodynamic-badge {
            background: linear-gradient(135deg, #FFF9C4 0%, #FBC02D 100%);
            color: #5D4037;
            padding: 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 15px rgba(251, 192, 45, 0.2);
        }
    </style>
</head>
<body class="pb-24">

    <div id="app" class="max-w-md mx-auto min-h-screen px-4 pt-6">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-lg font-medium text-muted">Ol√°, Guardi√£o!</h1>
                <p class="text-2xl font-extrabold tracking-tight">Horta Hero</p>
            </div>
            <div class="flex gap-3">
                <button onclick="toggleDarkMode()" class="w-10 h-10 rounded-full bg-white dark:bg-gray-800 flex items-center justify-center shadow-sm border border-gray-100">
                    <i class="fa-solid fa-moon"></i>
                </button>
                <div class="w-10 h-10 rounded-full bg-primary overflow-hidden border-2 border-white shadow-sm">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Avatar">
                </div>
            </div>
        </header>

        <main id="main-content">
            <!-- Dashboard View -->
            <div id="view-dashboard" class="fade-in">
                <!-- Biodynamic Tip -->
                <div class="biodynamic-badge mb-6">
                    <div class="w-10 h-10 bg-white/50 rounded-full flex items-center justify-center text-xl">
                        <i class="fa-solid fa-moon"></i>
                    </div>
                    <div>
                        <p class="text-[10px] uppercase opacity-70">Guia Biodin√¢mico de Hoje</p>
                        <p id="biodynamic-tip-text">Carregando sabedoria da terra...</p>
                    </div>
                </div>

                <!-- Impact Card -->
                <div class="premium-card impact-gradient p-6 mb-6 relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <p class="text-green-100 text-sm font-medium opacity-80">CO‚ÇÇ Sequestrado</p>
                                <h2 class="text-4xl font-extrabold mt-1"><span id="co2-val">0.0</span> <span class="text-xl font-normal">kg</span></h2>
                            </div>
                            <div class="bg-white/20 backdrop-blur-md p-2 rounded-xl">
                                <i class="fa-solid fa-leaf text-2xl"></i>
                            </div>
                        </div>
                        <button onclick="switchView('plantar')" class="w-full bg-white text-primary font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-transform">
                            Registrar A√ß√£o
                        </button>
                    </div>
                    <div class="absolute -right-10 -bottom-10 w-40 h-40 bg-white/10 rounded-full"></div>
                </div>

                <!-- Stats Row -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="premium-card p-4 flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center text-amber-600">
                            <i class="fa-solid fa-coins"></i>
                        </div>
                        <div>
                            <p class="text-xs text-muted font-bold">AgriEcoCoins</p>
                            <p class="text-lg font-extrabold" id="points-val">0</p>
                        </div>
                    </div>
                    <div class="premium-card p-4 flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-blue-100 flex items-center justify-center text-blue-600">
                            <i class="fa-solid fa-book"></i>
                        </div>
                        <div>
                            <p class="text-xs text-muted font-bold">Progresso</p>
                            <p class="text-lg font-extrabold">Livro 1</p>
                        </div>
                    </div>
                </div>

                <!-- Daily Mission -->
                <div class="premium-card p-5 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg">Desafio Carbono Zero</h3>
                        <span class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-lg font-bold">Meta Semanal</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex-1">
                            <div class="flex justify-between text-xs mb-1 font-bold">
                                <span>Reduza 5 kg de CO‚ÇÇ</span>
                                <span id="mission-progress-text">0.0 / 5 kg</span>
                            </div>
                            <div class="w-full bg-gray-100 rounded-full h-2">
                                <div id="mission-progress-bar" class="bg-green-500 h-2 rounded-full transition-all" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="w-12 h-12 flex items-center justify-center bg-amber-50 rounded-full border-2 border-amber-200">
                            <i class="fa-solid fa-medal text-amber-500"></i>
                        </div>
                    </div>
                </div>

                <!-- Section Title -->
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-extrabold text-xl">Minha Horta</h3>
                    <button onclick="switchView('jardim')" class="text-primary text-sm font-bold">Ver Tudo</button>
                </div>

                <!-- Garden Preview -->
                <div id="garden-preview" class="space-y-4 mb-6">
                    <div class="text-center py-10 text-muted italic">Sua horta est√° vazia. Comece a plantar!</div>
                </div>
            </div>

            <!-- Garden View -->
            <div id="view-jardim" class="hidden fade-in">
                <div class="flex items-center gap-4 mb-6">
                    <button onclick="switchView('dashboard')" class="w-10 h-10 rounded-xl bg-white flex items-center justify-center shadow-sm">
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>
                    <h2 class="text-2xl font-extrabold">Meu Jardim Digital</h2>
                </div>
                <div id="full-garden-list" class="space-y-4"></div>
            </div>

            <!-- Plantar View -->
            <div id="view-plantar" class="hidden fade-in">
                <div class="flex items-center gap-4 mb-6">
                    <button onclick="switchView('dashboard')" class="w-10 h-10 rounded-xl bg-white flex items-center justify-center shadow-sm">
                        <i class="fa-solid fa-chevron-left"></i>
                    </button>
                    <h2 class="text-2xl font-extrabold">Registrar Impacto</h2>
                </div>
                
                <!-- Category Filters -->
                <div class="flex gap-2 overflow-x-auto no-scrollbar mb-6 pb-2">
                    <button onclick="filterCatalog('Tudo')" class="filter-btn active" id="filter-Tudo">Tudo</button>
                    <button onclick="filterCatalog('Horta')" class="filter-btn" id="filter-Horta">Horta</button>
                    <button onclick="filterCatalog('Frut√≠fera')" class="filter-btn" id="filter-Frut√≠fera">Frut√≠feras</button>
                    <button onclick="filterCatalog('Leguminosa')" class="filter-btn" id="filter-Leguminosa">Leguminosas</button>
                    <button onclick="filterCatalog('Flor')" class="filter-btn" id="filter-Flor">Flores</button>
                </div>

                <div id="catalog-list" class="plant-grid"></div>
            </div>

            <!-- Ranking View -->
            <div id="view-ranking" class="hidden fade-in">
                <h2 class="text-2xl font-extrabold mb-6">Ranking da Comunidade</h2>
                <div class="premium-card overflow-hidden">
                    <div class="p-4 bg-gray-50 border-b flex justify-between text-xs font-bold text-muted">
                        <span>POSI√á√ÉO</span>
                        <span>CO‚ÇÇ SEQUESTRADO</span>
                    </div>
                    <div class="divide-y">
                        <div class="p-4 flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <span class="w-6 h-6 bg-amber-400 text-white rounded-full flex items-center justify-center text-[10px] font-bold">1¬∫</span>
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Fernanda" class="w-10 h-10 rounded-full bg-gray-100">
                                <span class="font-bold">Fernanda</span>
                            </div>
                            <span class="font-extrabold">12,5 kg</span>
                        </div>
                        <div class="p-4 flex justify-between items-center bg-green-50/50">
                            <div class="flex items-center gap-3">
                                <span class="w-6 h-6 bg-gray-300 text-white rounded-full flex items-center justify-center text-[10px] font-bold">2¬∫</span>
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="w-10 h-10 rounded-full bg-gray-100">
                                <span class="font-bold">Voc√™</span>
                            </div>
                            <span class="font-extrabold" id="ranking-user-co2">0,0 kg</span>
                        </div>
                        <div class="p-4 flex justify-between items-center">
                            <div class="flex items-center gap-3">
                                <span class="w-6 h-6 bg-amber-700 text-white rounded-full flex items-center justify-center text-[10px] font-bold">3¬∫</span>
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Lucas" class="w-10 h-10 rounded-full bg-gray-100">
                                <span class="font-bold">Lucas</span>
                            </div>
                            <span class="font-extrabold">8,3 kg</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button onclick="switchView('dashboard')" id="nav-dashboard" class="nav-item active">
                <i class="fa-solid fa-house text-xl"></i>
                <span>Dashboard</span>
            </button>
            <button onclick="switchView('jardim')" id="nav-jardim" class="nav-item">
                <i class="fa-solid fa-leaf text-xl"></i>
                <span>Meu Jardim</span>
            </button>
            <button onclick="switchView('plantar')" class="nav-center-btn">
                <i class="fa-solid fa-plus"></i>
            </button>
            <button onclick="switchView('ranking')" id="nav-ranking" class="nav-item">
                <i class="fa-solid fa-users text-xl"></i>
                <span>Comunidade</span>
            </button>
            <button class="nav-item opacity-50">
                <i class="fa-solid fa-gear text-xl"></i>
                <span>Ajustes</span>
            </button>
        </nav>
    </div>

    <!-- Plant Modal -->
    <div id="plant-modal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] hidden flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-t-[32px] sm:rounded-[32px] p-8 fade-in">
            <div class="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6 sm:hidden"></div>
            <h2 class="text-2xl font-extrabold mb-2" id="modal-title">Plantar Esp√©cie</h2>
            <p class="text-muted text-sm mb-6" id="modal-subtitle"></p>
            
            <form id="plant-form" class="space-y-6">
                <input type="hidden" id="selected-plant-id">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-bold text-muted uppercase mb-2">Quantidade</label>
                        <div class="flex items-center bg-gray-50 rounded-xl border">
                            <button type="button" onclick="adjustQty(-1)" class="p-3 text-primary"><i class="fa-solid fa-minus"></i></button>
                            <input type="number" id="plant-qty" value="1" min="1" class="w-full bg-transparent text-center font-bold outline-none">
                            <button type="button" onclick="adjustQty(1)" class="p-3 text-primary"><i class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-muted uppercase mb-2">√Årea (m¬≤)</label>
                        <input type="number" id="plant-area" value="1" step="0.1" class="w-full bg-gray-50 rounded-xl border p-3 font-bold outline-none focus:ring-2 focus:ring-primary">
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-muted uppercase mb-2">M√©todo de Plantio</label>
                    <div class="grid grid-cols-3 gap-2">
                        <label class="cursor-pointer"><input type="radio" name="method" value="semente" checked class="hidden peer"><div class="p-3 text-center rounded-xl border bg-white peer-checked:bg-green-50 peer-checked:border-primary peer-checked:text-primary transition-all"><div class="text-xs font-bold">Semente</div><div class="text-[10px] opacity-70">+50% pts</div></div></label>
                        <label class="cursor-pointer"><input type="radio" name="method" value="muda" class="hidden peer"><div class="p-3 text-center rounded-xl border bg-white peer-checked:bg-green-50 peer-checked:border-primary peer-checked:text-primary transition-all"><div class="text-xs font-bold">Muda</div><div class="text-[10px] opacity-70">+20% pts</div></div></label>
                        <label class="cursor-pointer"><input type="radio" name="method" value="transplante" class="hidden peer"><div class="p-3 text-center rounded-xl border bg-white peer-checked:bg-green-50 peer-checked:border-primary peer-checked:text-primary transition-all"><div class="text-xs font-bold">Transp.</div><div class="text-[10px] opacity-70">Normal</div></div></label>
                    </div>
                </div>
                <div class="flex gap-3 pt-2">
                    <button type="button" onclick="closePlantModal()" class="flex-1 bg-gray-100 text-gray-600 font-bold py-4 rounded-2xl">Cancelar</button>
                    <button type="submit" class="flex-[2] bg-primary text-white font-bold py-4 rounded-2xl shadow-lg shadow-green-900/20">Confirmar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- DATA ---
        const PLANT_CATALOG = [
            { id: 'alface', name: 'Alface', icon: 'ü•¨', co2: 0.5, growth: 45, category: 'Horta', stratum: 'Baixo', succession: 'Placenta I' },
            { id: 'tomate', name: 'Tomate', icon: 'üçÖ', co2: 2.5, growth: 90, category: 'Horta', stratum: 'M√©dio', succession: 'Secund√°ria I' },
            { id: 'cenoura', name: 'Cenoura', icon: 'ü•ï', co2: 0.8, growth: 80, category: 'Horta', stratum: 'Baixo', succession: 'Placenta II' },
            { id: 'pimentao', name: 'Piment√£o', icon: 'ü´ë', co2: 2.2, growth: 100, category: 'Horta', stratum: 'M√©dio', succession: 'Secund√°ria I' },
            { id: 'beringela', name: 'Berinjela', icon: 'üçÜ', co2: 2.4, growth: 110, category: 'Horta', stratum: 'M√©dio', succession: 'Secund√°ria I' },
            { id: 'quiabo', name: 'Quiabo', icon: 'üç¢', co2: 3.0, growth: 90, category: 'Horta', stratum: 'Alto', succession: 'Secund√°ria I' },
            { id: 'couve', name: 'Couve', icon: 'ü•¨', co2: 1.8, growth: 70, category: 'Horta', stratum: 'M√©dio', succession: 'Placenta II' },
            { id: 'manjericao', name: 'Manjeric√£o', icon: 'üåø', co2: 0.6, growth: 60, category: 'Horta', stratum: 'Baixo', succession: 'Placenta II' },
            { id: 'jabuticaba', name: 'Jabuticaba', icon: 'üü£', co2: 45.0, growth: 1825, category: 'Frut√≠fera', stratum: 'M√©dio', succession: 'Cl√≠max' },
            { id: 'pitanga', name: 'Pitanga', icon: 'üçí', co2: 25.0, growth: 1095, category: 'Frut√≠fera', stratum: 'M√©dio', succession: 'Secund√°ria III' },
            { id: 'araca', name: 'Ara√ß√°', icon: 'üü°', co2: 20.0, growth: 730, category: 'Frut√≠fera', stratum: 'Baixo', succession: 'Secund√°ria II' },
            { id: 'amora', name: 'Amora', icon: 'üçá', co2: 15.0, growth: 365, category: 'Frut√≠fera', stratum: 'M√©dio', succession: 'Secund√°ria I' },
            { id: 'feijao_porco', name: 'Feij√£o de Porco', icon: 'ü´ò', co2: 5.0, growth: 120, category: 'Leguminosa', stratum: 'Baixo', succession: 'Placenta I' },
            { id: 'guandu', name: 'Guandu', icon: 'üåø', co2: 8.0, growth: 180, category: 'Leguminosa', stratum: 'Alto', succession: 'Placenta II' },
            { id: 'mucuna', name: 'Mucuna', icon: 'üå±', co2: 12.0, growth: 150, category: 'Leguminosa', stratum: 'Emergente', succession: 'Placenta I' },
            { id: 'calendula', name: 'Cal√™ndula', icon: 'üåº', co2: 0.4, growth: 60, category: 'Flor', stratum: 'Baixo', succession: 'Placenta I' },
            { id: 'tagetes', name: 'Tagetes', icon: 'üèµÔ∏è', co2: 0.4, growth: 50, category: 'Flor', stratum: 'Baixo', succession: 'Placenta I' },
            { id: 'girassol', name: 'Girassol', icon: 'üåª', co2: 4.0, growth: 90, category: 'Flor', stratum: 'Emergente', succession: 'Placenta II' }
        ];

        const BIODYNAMIC_TIPS = [
            "Hoje √© dia de Fruto (Lua Crescente) - Ideal para plantar Tomates e Piment√µes!",
            "Hoje √© dia de Raiz (Lua Minguante) - Perfeito para Cenouras e Rabanetes.",
            "Hoje √© dia de Folha - √ìtimo para Alfaces, Couves e Manjeric√£o.",
            "Hoje √© dia de Flor - Cal√™ndulas e Girass√≥is v√£o amar ser plantados hoje!",
            "Lua Nova: Foco na aduba√ß√£o verde e prepara√ß√£o do solo com Leguminosas.",
            "Lua Cheia: M√°xima energia vital! Ideal para colheita de ervas medicinais."
        ];

        let gameState = { points: 0, co2: 0, garden: [], darkMode: false };
        let currentFilter = 'Tudo';

        // --- CORE ---
        function init() {
            const saved = localStorage.getItem('hortaHeroFinal');
            if (saved) {
                gameState = JSON.parse(saved);
                document.body.classList.toggle('dark-mode', gameState.darkMode);
                updateUI();
            }
            document.getElementById('biodynamic-tip-text').innerText = BIODYNAMIC_TIPS[Math.floor(Math.random() * BIODYNAMIC_TIPS.length)];
            renderCatalog();
            renderGarden();
        }

        function save() { localStorage.setItem('hortaHeroFinal', JSON.stringify(gameState)); }

        function updateUI() {
            document.getElementById('points-val').innerText = Math.floor(gameState.points);
            document.getElementById('co2-val').innerText = gameState.co2.toFixed(1);
            document.getElementById('ranking-user-co2').innerText = gameState.co2.toFixed(1) + ' kg';
            const missionProgress = Math.min((gameState.co2 / 5) * 100, 100);
            document.getElementById('mission-progress-bar').style.width = missionProgress + '%';
            document.getElementById('mission-progress-text').innerText = `${Math.min(gameState.co2, 5).toFixed(1)} / 5 kg`;
        }

        function switchView(viewId) {
            ['dashboard', 'jardim', 'plantar', 'ranking'].forEach(v => {
                document.getElementById(`view-${v}`).classList.add('hidden');
                const nav = document.getElementById(`nav-${v}`);
                if (nav) nav.classList.remove('active');
            });
            document.getElementById(`view-${viewId}`).classList.remove('hidden');
            const activeNav = document.getElementById(`nav-${viewId}`);
            if (activeNav) activeNav.classList.add('active');
            if (viewId === 'jardim') renderGarden();
            if (viewId === 'plantar') renderCatalog();
        }

        function toggleDarkMode() {
            gameState.darkMode = !gameState.darkMode;
            document.body.classList.toggle('dark-mode', gameState.darkMode);
            save();
        }

        // --- CATALOG & FILTERS ---
        function filterCatalog(category) {
            currentFilter = category;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter-${category}`).classList.add('active');
            renderCatalog();
        }

        function renderCatalog() {
            const container = document.getElementById('catalog-list');
            container.innerHTML = '';
            const filtered = currentFilter === 'Tudo' ? PLANT_CATALOG : PLANT_CATALOG.filter(p => p.category === currentFilter);
            filtered.forEach(plant => {
                const card = document.createElement('div');
                card.className = 'premium-card p-4 flex flex-col items-center text-center gap-2 cursor-pointer active:scale-95 transition-transform';
                card.onclick = () => openPlantModal(plant.id);
                card.innerHTML = `<div class="text-3xl mb-1">${plant.icon}</div><div class="font-bold text-sm">${plant.name}</div><div class="text-[10px] text-muted font-bold uppercase">${plant.category}</div><div class="flex gap-1 mt-1"><span class="text-[8px] bg-green-50 text-green-700 px-1.5 py-0.5 rounded border border-green-100">${plant.stratum}</span></div>`;
                container.appendChild(card);
            });
        }

        // --- MODAL ---
        function openPlantModal(plantId) {
            const plant = PLANT_CATALOG.find(p => p.id === plantId);
            if (!plant) return;
            document.getElementById('selected-plant-id').value = plantId;
            document.getElementById('modal-title').innerText = `Plantar ${plant.name}`;
            document.getElementById('modal-subtitle').innerText = `${plant.category} ‚Ä¢ Estrato ${plant.stratum} ‚Ä¢ ${plant.succession}`;
            document.getElementById('plant-modal').classList.remove('hidden');
        }
        function closePlantModal() { document.getElementById('plant-modal').classList.add('hidden'); }
        function adjustQty(val) { const input = document.getElementById('plant-qty'); input.value = Math.max(1, parseInt(input.value) + val); }

        document.getElementById('plant-form').onsubmit = (e) => {
            e.preventDefault();
            const plantId = document.getElementById('selected-plant-id').value;
            const qty = parseInt(document.getElementById('plant-qty').value);
            const area = parseFloat(document.getElementById('plant-area').value);
            const method = document.querySelector('input[name="method"]:checked').value;
            const plant = PLANT_CATALOG.find(p => p.id === plantId);
            let bonus = method === 'semente' ? 1.5 : (method === 'muda' ? 1.2 : 1.0);
            const pointsEarned = (plant.co2 * 10 * qty * bonus);
            gameState.garden.push({ instanceId: Date.now(), ...plant, qty, area, method, plantedAt: new Date().toISOString(), lastWatered: new Date().toISOString(), pointsEarned });
            gameState.points += pointsEarned;
            gameState.co2 += (plant.co2 * qty);
            save(); updateUI(); closePlantModal(); switchView('jardim');
        };

        // --- GARDEN ---
        function renderGarden() {
            const preview = document.getElementById('garden-preview');
            const full = document.getElementById('full-garden-list');
            preview.innerHTML = ''; full.innerHTML = '';
            if (gameState.garden.length === 0) {
                preview.innerHTML = '<div class="text-center py-10 text-muted italic">Sua horta est√° vazia. Comece a plantar!</div>';
                full.innerHTML = '<div class="text-center py-10 text-muted italic">Nada plantado ainda.</div>';
                return;
            }
            const sorted = [...gameState.garden].reverse();
            sorted.slice(0, 3).forEach(item => preview.appendChild(createGardenCard(item)));
            sorted.forEach(item => full.appendChild(createGardenCard(item, true)));
        }

        function createGardenCard(item, isFull = false) {
            const card = document.createElement('div');
            card.className = 'premium-card p-4 flex items-center gap-4 relative overflow-hidden';
            card.innerHTML = `
                <div class="w-14 h-14 rounded-2xl bg-gray-50 flex items-center justify-center text-3xl shadow-inner">${item.icon}</div>
                <div class="flex-1">
                    <div class="flex justify-between items-start"><h4 class="font-extrabold">${item.name} <span class="text-xs text-muted font-normal">x${item.qty}</span></h4><span class="text-[10px] font-bold text-primary bg-green-50 px-2 py-0.5 rounded-full">${item.stratum}</span></div>
                    <p class="text-[10px] text-muted font-medium mb-2">Plantado em ${new Date(item.plantedAt).toLocaleDateString('pt-BR')} ‚Ä¢ ${item.area}m¬≤</p>
                    <div class="w-full bg-gray-100 h-1.5 rounded-full overflow-hidden"><div class="bg-primary h-full" style="width: 20%"></div></div>
                </div>
                <div class="flex flex-col gap-2">
                    <button onclick="waterPlant(event, ${item.instanceId})" class="w-8 h-8 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center active:scale-90 transition-transform"><i class="fa-solid fa-droplet text-xs"></i></button>
                    ${isFull ? `<button onclick="removePlant(${item.instanceId})" class="w-8 h-8 rounded-lg bg-red-50 text-red-600 flex items-center justify-center active:scale-90 transition-transform"><i class="fa-solid fa-trash text-xs"></i></button>` : ''}
                </div>`;
            return card;
        }

        function waterPlant(e, instanceId) {
            gameState.points += 5;
            save(); updateUI();
            const btn = e.currentTarget;
            const rect = btn.getBoundingClientRect();
            for(let i=0; i<3; i++) {
                const drop = document.createElement('i');
                drop.className = 'fa-solid fa-droplet water-drop';
                drop.style.left = (rect.left + rect.width/2) + 'px';
                drop.style.top = (rect.top) + 'px';
                drop.style.marginLeft = (Math.random() * 20 - 10) + 'px';
                document.body.appendChild(drop);
                setTimeout(() => drop.remove(), 800);
            }
            btn.classList.add('bg-blue-500', 'text-white');
            setTimeout(() => btn.classList.remove('bg-blue-500', 'text-white'), 500);
        }

        function removePlant(instanceId) {
            if (confirm('Deseja remover esta planta?')) {
                gameState.garden = gameState.garden.filter(p => p.instanceId !== instanceId);
                save(); renderGarden(); updateUI();
            }
        }

        window.onload = init;
    </script>
</body>
</html>
